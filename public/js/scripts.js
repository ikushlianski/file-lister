"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}return Array.from(e)}function insertFileIntoDOM(e,a,t,r){var s=new Date(1e3*a),n=s.getFullYear()+"/"+(s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1)+"/"+(s.getDate()<10?"0"+s.getDate():s.getDate())+" "+(s.getHours()<10?"0"+s.getHours():s.getHours())+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes())+":"+(s.getSeconds()<10?"0"+s.getSeconds():s.getSeconds()),o=Math.round(t/1024*100)/100,i=$(".referenceNode")[0],l=i.cloneNode(!0),d=$(l);d.removeClass("referenceNode hidden"),d.children().eq(0).text(e),d.children().eq(1).text(n),d.children().eq(2).text(o),d.children().eq(3).children().attr("data-fhash",r),d.children().eq(4).children().attr("data-fhash",r),$(".filesAvailable tbody").append(d),d.css("backgroundColor","teal"),d.animate({backgroundColor:"#f5f5f5"},1e3),$(".filesAvailable th").each(function(){($(this).hasClass("sorted-asc")||$(this).hasClass("sorted-desc"))&&$(this).trigger("click").trigger("click")})}function removeFileFromDOM(e){e.css("backgroundColor","#f5f5f5"),e.animate({backgroundColor:"#ef5350cc"},1e3,function(){$(this).remove()})}function displayFeedbackMessage(e){M.toast({html:e})}function showProgressBar(){$(".progressBarWrapper").removeClass("hidden"),$(".page_wrapper").addClass("darkened")}function removeProgressBar(){$(".progressBarWrapper").addClass("hidden"),$(".page_wrapper").removeClass("darkened"),$(".progressBar").val(0)}function updateSpaceDataUI(e,a,t,r){function s(e,a){var t=$("."+e);t.text(a),t.addClass("newlyInserted"),setTimeout(function(){return t.removeClass("newlyInserted")},2e3)}s("freeSpaceMB",e),s("filesTotalSpaceKB",a),s("fileCount",t),s("avgFileSpacePerUser",r)}$(document).ready(function(){var e=document.forms.namedItem("fileinfo");e&&$(e).on("submit",function(a){a.preventDefault();var t=$("#file-upload-field"),r=$("#submitFileUrlForUpload");showProgressBar(),r.attr("disabled","disabled");r.html();r.addClass("waiting");var s=new FormData(e);$.ajax({async:!0,contentType:!1,data:s,enctype:"multipart/form-data",processData:!1,type:"POST",url:"/addfile/ajaxupload",xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){e.lengthComputable&&$(".progressBar").val(e.loaded/e.total)},!1),e}}).done(function(e,a){var t=JSON.parse(e);t.hasOwnProperty("row")&&insertFileIntoDOM(t.row.f_name,t.row.f_date,t.row.f_size,t.row.f_hash),t.message&&displayFeedbackMessage(t.message),t.spaceInfo&&updateSpaceDataUI(t.spaceInfo.userFreeSpaceInMB,t.spaceInfo.filesTotalSpaceKB,t.spaceInfo.fileCount,t.spaceInfo.avgFileSpacePerUser)}).fail(function(){displayFeedbackMessage("Error occurred")}).always(function(){r.removeClass("waiting"),removeProgressBar(),t.val(null),$(".file-path-wrapper > .file-path").val(null)})});var a=$("#fileDeletionForm");a&&a.on("submit",function(e){e.preventDefault();var t,r=$("#filetodelete"),s=r.val(),n=$(".fileDeleteButton[data-fhash]");n.each(function(){$(this).attr("data-fhash")===s&&(t=$(this).parent().parent())});var o=new FormData(a[0]);o.append(r.attr("name"),r.val()),$.ajax({async:!0,contentType:!1,data:o,processData:!1,type:"POST",url:"/home/ajaxdelete"}).done(function(e){var a=JSON.parse(e);!0===a.deletionStatus&&removeFileFromDOM(t),a.message&&displayFeedbackMessage(a.message),a.spaceInfo&&updateSpaceDataUI(a.spaceInfo.userFreeSpaceInMB,a.spaceInfo.filesTotalSpaceKB,a.spaceInfo.fileCount,a.spaceInfo.avgFileSpacePerUser)}).fail(function(){displayFeedbackMessage("Error occurred")})});var t=$("#curlDownloadForm");t&&t.on("submit",function(e){function a(){$.ajax({type:"GET",url:"/downloadfile/trackprogress",xhr:function(){var e=$.ajaxSettings.xhr();return $(e).on("readystatechange",function(e){var t=e.target;if(4===t.readyState){if("1"===t.responseText){if(n.length>0&&1!==n[n.length-1])return void(n=[])}else isFinite(+t.responseText)&&($(".progressBar")[0].value=t.responseText);n.push(t.responseText),setTimeout(a,100)}}),e}})}if("directly"!==$('#curlDownloadForm input[type="radio"]:checked').val()){e.preventDefault();var r=$("#submitFileUrlForDownload"),s=new FormData(t[0]);s.append(r.attr("name"),r.val()),r.addClass("waiting"),showProgressBar(),r.attr("disabled","disabled"),$.ajax({async:!0,contentType:!1,data:s,processData:!1,type:"POST",url:"/downloadfile/ajaxdownload"}).done(function(e){var a=JSON.parse(e);!0===a.curlDownloadStatus?(insertFileIntoDOM(a.row.f_name,a.row.f_date,a.row.f_size,a.row.f_hash),a.message&&displayFeedbackMessage(a.message),a.spaceInfo&&updateSpaceDataUI(a.spaceInfo.userFreeSpaceInMB,a.spaceInfo.filesTotalSpaceKB,a.spaceInfo.fileCount,a.spaceInfo.avgFileSpacePerUser)):a.message&&displayFeedbackMessage(a.message)}).fail(function(){displayFeedbackMessage("Error occurred")}).always(function(){removeProgressBar(),r.removeClass("waiting"),$("#curlDownloadForm input[name='downloadUrl']").val(null)});var n=[];a()}})}),$(document).ready(function(){$(document).ready(function(){$(".fixed-action-btn").floatingActionButton()}),$("#file-upload-field").change(function(){$(this)[0].files.length>0?$("[name='fileSubmitted']").prop("disabled",!1):$("[name='fileSubmitted']").prop("disabled",!0)}),$("[name='downloadUrl']").on("input",function(){""!==$(this)[0].value?$("#submitFileUrlForDownload").prop("disabled",!1):$("#submitFileUrlForDownload").prop("disabled",!0)})}),$(document).ready(function(){$(".filesAvailable").on("click",".fileDeleteButton",function(e){e.preventDefault();var a=$(this).data("fhash");$("#filetodelete").val(a),$("#filetodelete").trigger("click")}),$(".filesAvailable").on("click",".fileDownloadButton",function(e){e.preventDefault();var a=$(this).data("fhash");$("#singlefiletodownload").val(a),$("#singlefiletodownload").trigger("click")})}),$(".filesAvailable").on("mouseenter","td.sort_filename",function(e){var a=$(e.target);if(a.is($(this))){if(a.children(".imagePreview").length>0)return void a.children(".imagePreview").fadeIn(200);if(!a.hasClass("preventAjax")){var t=$(e.target).text(),r=$(e.target).siblings().children(".fileDownloadButton").data("fhash");$.ajax({async:!0,data:{filename:t,filehash:r,getimagepreview:!0},type:"POST",url:"/downloadfile/imagepreview"}).done(function(e){var t=JSON.parse(e);if(!1==!!t.imagePreviewStatus)return t.message&&displayFeedbackMessage(t.message),void("image/jpeg"!==t.mime&&"image/png"!==t.mime&&a.addClass("preventAjax"));0===a.children(".imagePreview").length&&$(new Image).attr("src",t.src).addClass("imagePreview").hide().appendTo(a).fadeIn(200)}).fail(function(){alert("Image preview not available")})}}}).on("mouseleave","td.sort_filename",function(e){var a=$(e.target);a.is($(this))&&a.children("img.imagePreview").fadeOut(200)}),$(document).ready(function(){var e=$(".js-message-error").data("message");e&&M.toast({html:e});var a=$(".js-message-success").data("message");a&&M.toast({html:a})}),$(document).ready(function(){$(".modal").modal()}),$(window).on("load",function(){$(".preloader-back").fadeOut(100,function(){$(this).remove()})}),$(document).ready(function(){$(".sidenav").sidenav()}),$(document).ready(function(){function e(e){var a=$("th."+e).first(),t=$("td."+e);if(t=[].concat(_toConsumableArray(t)),a.hasClass("sorted-asc"))a.removeClass("sorted-asc"),a.addClass("sorted-desc");else if(a.hasClass("sorted-desc"))a.removeClass("sorted-desc"),a.addClass("sorted-asc");else{var r=$("th");r.each(function(){$(this).removeClass("sorted-asc sorted-desc")}),a.addClass("sorted-asc")}a.hasClass("sorted-asc")&&t.sort(function(e,a){return t.some(function(e){return/[^\d.]/.test(e.textContent)})?$(e).text().toLowerCase()<$(a).text().toLowerCase()?($(e).parent().after($(a).parent()),-1):$(e).text().toLowerCase()>$(a).text().toLowerCase()?($(e).parent().before($(a).parent()),1):0:Number($(e).text())<Number($(a).text())?($(e).parent().after($(a).parent()),-1):Number($(e).text())>Number($(a).text())?($(e).parent().before($(a).parent()),1):0}),a.hasClass("sorted-desc")&&$(t).each(function(){$(this).parent().parent().prepend($(this).parent())})}$("th.sortable").each(function(a,t){var r=Array.prototype.slice.call(t.classList),s=r.toString().match(/sort_.+?\b/)[0];$(this).on("click",function(){return e(s)})})});